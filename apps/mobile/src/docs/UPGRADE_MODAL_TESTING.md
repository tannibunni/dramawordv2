# 🔧 升级弹窗测试指南

## 🎯 测试目标

验证升级弹窗的功能是否正常工作，包括：
- 弹窗正确显示
- 内容准确显示
- "立即升级"按钮导航正常
- "稍后再说"按钮关闭正常

## 🧪 测试步骤

### 第一步：模拟试用期结束

1. 打开应用，进入 `Profile` 页面
2. 滚动到底部，找到 "🧪 开发测试" 区域
3. 点击 **"模拟试用期到期"** 按钮
4. 确认看到提示："已切换到: 试用期已结束"

### 第二步：触发升级弹窗

1. 进入 `Review` 页面
2. 尝试点击以下任一功能：
   - 智能挑战按钮
   - 错词挑战按钮
   - 剧集复习卡片
   - 单词本复习卡片
   - 每日奖励按钮

### 第三步：验证升级弹窗内容

**检查弹窗是否显示以下内容：**

✅ **头部区域**：
- 功能图标（颜色正确）
- 功能名称
- 功能描述

✅ **锁定提示区域**：
- 锁定图标
- "功能已锁定" 标题
- 试用期结束提示文案

✅ **升级好处区域**：
- "升级后您将获得" 标题
- 4个好处项目：
  - 无限功能访问
  - 云端数据同步
  - 详细学习统计
  - 专属学习奖励

✅ **按钮区域**：
- "立即升级" 按钮（蓝紫色渐变）
- "稍后再说" 按钮

### 第四步：测试按钮功能

**测试"立即升级"按钮：**
1. 点击 "立即升级" 按钮
2. 检查控制台日志：
   ```
   [UpgradeModal] 用户点击立即升级按钮
   [ReviewIntroScreen] 开始处理升级操作
   [ReviewIntroScreen] 升级弹窗已关闭，准备导航到Subscription页面
   [ReviewIntroScreen] 导航到Subscription页面成功
   ```
3. 确认应用导航到订阅页面

**测试"稍后再说"按钮：**
1. 重新触发升级弹窗
2. 点击 "稍后再说" 按钮
3. 检查控制台日志：
   ```
   [UpgradeModal] 用户点击稍后再说按钮
   ```
4. 确认弹窗关闭，停留在当前页面

**测试关闭按钮：**
1. 重新触发升级弹窗
2. 点击右上角的 "×" 关闭按钮
3. 确认弹窗关闭

### 第五步：测试不同功能的弹窗

分别触发不同功能的升级弹窗，验证：

1. **复习功能** (`review`)：
   - 图标：refresh-outline
   - 颜色：橙色 (#FF9800)

2. **词汇本功能** (`vocabulary`)：
   - 图标：book-outline
   - 颜色：绿色 (#4CAF50)

3. **每日奖励** (`dailyRewards`)：
   - 图标：gift-outline
   - 颜色：粉色 (#E91E63)

4. **高级搜索** (`advancedSearch`)：
   - 图标：search-outline
   - 颜色：紫色 (#9C27B0)

## 🐛 常见问题排查

### 问题1：升级弹窗没有显示

**可能原因**：
1. 试用期状态设置失败
2. 功能权限检查逻辑错误

**排查步骤**：
1. 检查控制台是否有测试状态设置成功的日志
2. 检查 `FeatureAccessService.checkAndHandleAccess` 的返回值
3. 确认升级弹窗回调是否正确注册

### 问题2："立即升级"按钮导航失败

**可能原因**：
1. 导航上下文未正确初始化
2. 路由配置错误

**排查步骤**：
1. 检查控制台错误日志
2. 确认 `NavigationContext` 是否可用
3. 验证 `'Subscription'` 路由是否在 `MainLayout.tsx` 中正确配置

### 问题3：弹窗内容显示异常

**可能原因**：
1. 功能配置错误
2. 翻译文本缺失
3. 样式问题

**排查步骤**：
1. 检查 `featureAccessService.ts` 中的 `FEATURE_CONFIGS`
2. 确认语言设置是否正确
3. 检查样式是否有冲突

## ✅ 验收标准

测试通过的标准：

1. ✅ 升级弹窗能正确显示
2. ✅ 弹窗内容完整准确
3. ✅ 功能图标和颜色正确
4. ✅ "立即升级"按钮导航到订阅页面
5. ✅ "稍后再说"按钮关闭弹窗
6. ✅ 关闭按钮正常工作
7. ✅ 不同功能的弹窗显示正确
8. ✅ 控制台日志输出正常

## 🔄 测试后清理

测试完成后记得：

1. 进入 `Profile` 页面
2. 滚动到底部开发测试区域
3. 点击 **"清除测试状态"** 按钮
4. 确认应用恢复正常状态

---

**注意**：此测试指南仅适用于开发环境，生产环境中不会显示测试按钮。
