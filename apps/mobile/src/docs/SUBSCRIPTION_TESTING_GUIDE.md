# 📋 订阅功能测试指南

## 🎯 测试目标

验证14天试用期结束后的功能限制是否正常工作，确保：
- 试用期内所有功能可用
- 试用期结束后只有查单词功能可用
- 其他功能被锁定并显示升级弹窗
- 付费会员可以访问所有功能

## 🧪 测试工具使用

### 1. 打开测试工具

在**开发模式**下，进入 `ProfileScreen` → `设置` → `🧪 订阅状态测试`

### 2. 可用的测试状态

| 状态 | 描述 | 预期行为 |
|------|------|----------|
| **试用期激活中** | 用户正在14天试用期内 | 所有功能可用 |
| **试用期已结束** | 14天试用期已结束 | 只有查单词功能可用 |
| **付费会员（月度）** | 付费月度会员 | 所有功能可用 |
| **付费会员（年度）** | 付费年度会员 | 所有功能可用 |
| **免费用户** | 从未试用过的免费用户 | 只有查单词功能可用 |

### 3. 快捷操作

- **模拟试用期到期**：直接切换到试用期结束状态
- **模拟购买月度订阅**：切换到付费月度会员状态
- **重置为试用期**：重置到试用期激活状态
- **清除测试状态**：恢复正常模式

## 🔍 功能测试清单

### ✅ 试用期激活状态测试

1. 设置测试状态为 "试用期激活中"
2. 验证以下功能可用：
   - ✅ 复习功能 (ReviewIntroScreen)
   - ✅ 词汇本功能 (VocabularyScreen)
   - ✅ 每日奖励 (DailyRewardsButton)
   - ✅ 高级搜索 (WordSearchScreen)
   - ✅ 查单词功能（基础）

### ❌ 试用期结束状态测试

1. 设置测试状态为 "试用期已结束"
2. 验证以下功能被锁定：
   - ❌ 复习功能 → 显示升级弹窗
   - ❌ 词汇本功能 → 显示升级弹窗
   - ❌ 每日奖励 → 显示升级弹窗
   - ❌ 高级搜索（非中英文） → 显示升级弹窗
   - ✅ 查单词功能（中英文） → 正常使用

### 💎 付费会员状态测试

1. 设置测试状态为 "付费会员（月度）"
2. 验证以下功能全部可用：
   - ✅ 所有功能正常使用
   - ✅ 无升级弹窗

## 🎮 测试步骤

### 步骤1：模拟试用期到期

```bash
1. 打开测试工具面板
2. 点击 "模拟试用期到期"
3. 确认当前状态变为 "试用期已结束"
4. 测试各个功能入口
```

### 步骤2：测试功能限制

```bash
1. 进入 ReviewIntroScreen
2. 点击复习相关按钮
3. 验证升级弹窗是否出现
4. 测试其他受限功能
```

### 步骤3：测试升级弹窗

```bash
1. 点击受限功能
2. 验证弹窗内容：
   - 功能图标和名称
   - 功能描述
   - 升级好处列表
   - "立即升级" 按钮
   - "稍后再说" 按钮
```

### 步骤4：测试付费会员

```bash
1. 点击 "模拟购买月度订阅"
2. 确认所有功能恢复可用
3. 验证无升级弹窗出现
```

## 🐛 常见问题排查

### 问题1：测试状态不生效

**解决方案**：
1. 确保在开发模式下 (`__DEV__ = true`)
2. 检查控制台日志是否有错误
3. 尝试清除测试状态后重新设置

### 问题2：升级弹窗不显示

**解决方案**：
1. 检查 `FeatureAccessService.setUpgradeModalCallback` 是否正确设置
2. 确认 `checkAndHandleAccess` 返回 `false`
3. 查看控制台日志

### 问题3：功能权限检查不正确

**解决方案**：
1. 检查 `subscriptionService.checkSubscriptionStatus()` 返回的状态
2. 验证 `featureAccessService.ts` 中的权限配置
3. 确认测试数据格式正确

## 📊 测试报告模板

```markdown
## 功能权限测试报告

### 测试环境
- 日期：[测试日期]
- 版本：[应用版本]
- 平台：[iOS/Android]

### 测试结果

| 功能 | 试用期内 | 试用期结束 | 付费会员 | 状态 |
|------|----------|------------|----------|------|
| 复习功能 | ✅ | ❌ | ✅ | PASS |
| 词汇本 | ✅ | ❌ | ✅ | PASS |
| 每日奖励 | ✅ | ❌ | ✅ | PASS |
| 高级搜索 | ✅ | ❌ | ✅ | PASS |
| 查单词 | ✅ | ✅ | ✅ | PASS |

### 升级弹窗测试
- [ ] 弹窗正常显示
- [ ] 功能图标正确
- [ ] 文案准确
- [ ] 按钮功能正常

### 问题记录
[记录发现的问题]

### 总结
[测试总结]
```

## 🚀 自动化测试建议

建议后续可以添加自动化测试：

```typescript
// 示例：自动化功能权限测试
describe('Feature Access Control', () => {
  beforeEach(async () => {
    await SubscriptionTestService.clearTestState();
  });

  it('should restrict features when trial expired', async () => {
    await SubscriptionTestService.setTestState('trial_expired');
    
    const canAccessReview = await FeatureAccessService.canAccessFeature('review');
    expect(canAccessReview).toBe(false);
    
    const canAccessWordLookup = await FeatureAccessService.canAccessFeature('wordLookup');
    expect(canAccessWordLookup).toBe(true);
  });
});
```

## 🎯 验收标准

测试通过的标准：

1. ✅ 试用期内所有功能可用
2. ✅ 试用期结束后只有查单词可用
3. ✅ 受限功能显示升级弹窗
4. ✅ 付费会员所有功能可用
5. ✅ 升级弹窗UI正确显示
6. ✅ 状态切换正常工作
7. ✅ 测试工具功能完整

---

**注意**：测试完成后记得清除测试状态，恢复正常模式！
